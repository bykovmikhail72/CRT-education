# Первая стадия
# Говорим докеру, что работаем от образа node 14 версии alpine(минифицированная версия), называем стадию как dev
FROM node:14.20.0-alpine AS dev
# Прописываем рабочую директорию, куда сложим файлы
WORKDIR /app
# Копируем package.json (необходимо для оптимизации, для предотвращения повторной загрузки зависимостей)
COPY package.json ./
# Устанавливаем модули из зависимостей
RUN npm install
# Копируем файлы в рабочую директорию
COPY . .
# Создаем продакшн версию приложения для минифицирования
RUN npm run build

# Вторая стадия
# Говорим докеру, что работаем от образа nginx последней стабильной минифицированной версии, называем стадию как prod
FROM nginx:1.23.1-alpine AS prod

# Копируем папку build из dev стадии и помещаем в специальную директорию nginx
COPY --from=dev /app/build /usr/share/nginx/html

# Задаем порт для развертывания приложения
EXPOSE 80
# Запускаем программу
CMD ["nginx", "-g", "daemon off;"]

